--胡昊添加3年日经营统计
alter table statistic_app_data add (
	add3 number(11,0),
	renew3 number(11,0),
	update_change_num3 number(11,0),
	update_lost_num3 number(11,0),
	update_replace_num3 number(11,0),
	change_update_lost_num3 number(11,0),
	change_update_replace_num3 number(11,0)
	);

--yichao，定时任务数据表更新
alter table statistic_cert_data add (
	add3 number(11,0),
	renew3 number(11,0)
	);

alter table statistic_cert_data_product add year3 number(11,0);


-- 供应商三年期字段
ALTER TABLE settle_supplier_cert_detail ADD AMOUNT_YEAR3 (NUMBER(10,0));

-- 年限结算保存日志查看权限
Insert into OPERATOR_SC.SYS_MENU (ID,PARENT_ID,PARENT_IDS,NAME,HREF,TARGET,ICON,SORT,IS_SHOW,PERMISSION,CREATE_BY,CREATE_DATE,UPDATE_BY,UPDATE_DATE,REMARKS,DEL_FLAG) values (10861500,10747417,'0,1,184,185,10747417,','年限结算保存日志查看',null,null,null,30,'0','settle:settlementLog:view',1,to_date('08-3月 -16','DD-MON-RR'),1,to_date('08-3月 -16','DD-MON-RR'),null,'0');

-- settlement_log 表
ALTER TABLE SETTLEMENT_LOG
ADD CONSTRAINT FKEE689F2E20BD22CE FOREIGN KEY
(
  CREATE_BY 
)
REFERENCES SYS_USER
(
  ID 
)
ENABLE
ALTER TABLE SETTLEMENT_LOG
ADD CONSTRAINT FKEE689F2E88E45BE1 FOREIGN KEY
(
  UPDATE_BY 
)
REFERENCES SYS_USER
(
  ID 
)
ENABLECREATE TABLE SETTLEMENT_LOG 
(
  ID NUMBER(19, 0) NOT NULL 
, CREATE_DATE TIMESTAMP(6) 
, DEL_FLAG VARCHAR2(1 CHAR) 
, REMARKS VARCHAR2(255 CHAR) 
, UPDATE_DATE TIMESTAMP(6) 
, APP_NAME VARCHAR2(100 CHAR) 
, COMAGENT_NAME VARCHAR2(100 CHAR) 
, COMAGENT_VALIDITY VARCHAR2(255 CHAR) 
, END_TIME TIMESTAMP(6) 
, PRODUCT_NAME NVARCHAR2(255) 
, START_TIME TIMESTAMP(6) 
, USER_NAME VARCHAR2(100 CHAR) 
, CREATE_BY NUMBER(19, 0) 
, UPDATE_BY NUMBER(19, 0) 
, CONSTRAINT SYS_C0014917 PRIMARY KEY 
  (
    ID 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX SYS_C0014917 ON SETTLEMENT_LOG (ID ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        INITIAL 65536 
        NEXT 1048576 
        MINEXTENTS 1 
        MAXEXTENTS UNLIMITED 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
) 
LOGGING 
TABLESPACE USERS 
PCTFREE 10 
INITRANS 1 
STORAGE 
( 
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1 
  MAXEXTENTS UNLIMITED 
  BUFFER_POOL DEFAULT 
) 
NOCOMPRESS
REM INSERTING into OPERATOR_SC.SETTLEMENT_LOG
SET DEFINE OFF;


-- work_deal_info_settlement_log 表
ALTER TABLE WORK_DEAL_INFO_SETTLEMENT_LOG
ADD CONSTRAINT FKF76443FA20BD22CE FOREIGN KEY
(
  CREATE_BY 
)
REFERENCES SYS_USER
(
  ID 
)
ENABLE
ALTER TABLE WORK_DEAL_INFO_SETTLEMENT_LOG
ADD CONSTRAINT FKF76443FA88E45BE1 FOREIGN KEY
(
  UPDATE_BY 
)
REFERENCES SYS_USER
(
  ID 
)
ENABLE
ALTER TABLE WORK_DEAL_INFO_SETTLEMENT_LOG
ADD CONSTRAINT FKF76443FAD952476C FOREIGN KEY
(
  WORK_DEAL_INFOS_ID 
)
REFERENCES SETTLEMENT_LOG
(
  ID 
)
ENABLECREATE TABLE WORK_DEAL_INFO_SETTLEMENT_LOG 
(
  ID NUMBER(19, 0) NOT NULL 
, CREATE_DATE TIMESTAMP(6) 
, DEL_FLAG VARCHAR2(1 CHAR) 
, REMARKS VARCHAR2(255 CHAR) 
, UPDATE_DATE TIMESTAMP(6) 
, WORK_DEAL_INF_ID NUMBER(19, 0) 
, CREATE_BY NUMBER(19, 0) 
, UPDATE_BY NUMBER(19, 0) 
, WORK_DEAL_INFOS_ID NUMBER(19, 0) 
, CONSTRAINT SYS_C0014919 PRIMARY KEY 
  (
    ID 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX SYS_C0014919 ON WORK_DEAL_INFO_SETTLEMENT_LOG (ID ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        INITIAL 65536 
        NEXT 1048576 
        MINEXTENTS 1 
        MAXEXTENTS UNLIMITED 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
) 
LOGGING 
TABLESPACE USERS 
PCTFREE 10 
INITRANS 1 
STORAGE 
( 
  INITIAL 65536 
  NEXT 1048576 
  MINEXTENTS 1 
  MAXEXTENTS UNLIMITED 
  BUFFER_POOL DEFAULT 
) 
NOCOMPRESS
REM INSERTING into OPERATOR_SC.WORK_DEAL_INFO_SETTLEMENT_LOG
SET DEFINE OFF;
-----更新历史数据
update  WORK_DEAL_INFO t set t.office_id = (select  u.office_id from sys_user u where u.id = t.create_by);
update  WORK_DEAL_INFO t set t.area_id = (select  o.parent_id from sys_office o where o.id = t.office_id);